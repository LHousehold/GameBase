import{S as e,i as t,s as a,e as o,t as n,c as s,a as c,g as l,d as r,f as i,F as m,h as g,k as u,n as d,b as h,H as w,I as f,G as p,J as y,K as I,A as S,L as v}from"../chunks/vendor-3da8612c.js";function N(e,t,a){const o=e.slice();return o[13]=t[a],o}function T(e){let t,a,u=e[13].name+"";return{c(){t=o("p"),a=n(u)},l(e){t=s(e,"P",{});var o=c(t);a=l(o,u),o.forEach(r)},m(e,o){i(e,t,o),m(t,a)},p(e,t){4&t&&u!==(u=e[13].name+"")&&g(a,u)},d(e){e&&r(t)}}}function b(e){let t,a,g,S,v,b,E,O,P,G,J,j,U,$,k,D,q,A,B,C,V,R,x,M,Q,F=e[2]?e[2].players:[],H=[];for(let o=0;o<F.length;o+=1)H[o]=T(N(e,F,o));return{c(){t=o("main"),a=o("div"),g=o("input"),S=u(),v=o("button"),b=n("Create game"),E=u(),O=o("br"),P=u(),G=o("div"),J=o("input"),j=u(),U=o("input"),$=u(),k=o("button"),D=n("Join Game"),q=u(),A=o("div"),B=o("button"),C=n("Quit Game"),V=u(),R=o("div"),x=n("Players:\n\t\t");for(let e=0;e<H.length;e+=1)H[e].c();this.h()},l(e){t=s(e,"MAIN",{});var o=c(t);a=s(o,"DIV",{class:!0});var n=c(a);g=s(n,"INPUT",{}),S=d(n),v=s(n,"BUTTON",{});var i=c(v);b=l(i,"Create game"),i.forEach(r),n.forEach(r),E=d(o),O=s(o,"BR",{}),P=d(o),G=s(o,"DIV",{class:!0});var m=c(G);J=s(m,"INPUT",{}),j=d(m),U=s(m,"INPUT",{}),$=d(m),k=s(m,"BUTTON",{});var u=c(k);D=l(u,"Join Game"),u.forEach(r),m.forEach(r),q=d(o),A=s(o,"DIV",{class:!0});var h=c(A);B=s(h,"BUTTON",{});var w=c(B);C=l(w,"Quit Game"),w.forEach(r),h.forEach(r),V=d(o),R=s(o,"DIV",{class:!0});var f=c(R);x=l(f,"Players:\n\t\t");for(let t=0;t<H.length;t+=1)H[t].l(f);f.forEach(r),o.forEach(r),this.h()},h(){h(a,"class","svelte-qemy0u"),h(G,"class","svelte-qemy0u"),h(A,"class","svelte-qemy0u"),h(R,"class","svelte-qemy0u")},m(o,n){i(o,t,n),m(t,a),m(a,g),w(g,e[0]),m(a,S),m(a,v),m(v,b),m(t,E),m(t,O),m(t,P),m(t,G),m(G,J),w(J,e[0]),m(G,j),m(G,U),w(U,e[1]),m(G,$),m(G,k),m(k,D),m(t,q),m(t,A),m(A,B),m(B,C),m(t,V),m(t,R),m(R,x);for(let e=0;e<H.length;e+=1)H[e].m(R,null);M||(Q=[f(g,"input",e[6]),f(v,"click",e[3]),f(J,"input",e[7]),f(U,"input",e[8]),f(k,"click",e[4]),f(B,"click",e[5])],M=!0)},p(e,[t]){if(1&t&&g.value!==e[0]&&w(g,e[0]),1&t&&J.value!==e[0]&&w(J,e[0]),2&t&&U.value!==e[1]&&w(U,e[1]),4&t){let a;for(F=e[2]?e[2].players:[],a=0;a<F.length;a+=1){const o=N(e,F,a);H[a]?H[a].p(o,t):(H[a]=T(o),H[a].c(),H[a].m(R,null))}for(;a<H.length;a+=1)H[a].d(1);H.length=F.length}},i:p,o:p,d(e){e&&r(t),y(H,e),M=!1,I(Q)}}}function E(e,t,a){let o,n,s,c,l;console.log("Refreshing...");const r=async()=>{console.log("Connecting...");const e=await(new v).withUrl("/api").withAutomaticReconnect().build();return await e.start(),e};S((async()=>{if(l=await r(),l.on("newMessage",(e=>{a(2,s=e)})),window.localStorage.getItem("playerSecret")&&window.localStorage.getItem("gameId")){c=window.localStorage.getItem("playerSecret"),a(1,n=window.localStorage.getItem("gameId")),console.log(`Automatically joining: ${n} as ${c}`);const e=await i();console.log(e),a(2,s=e.gameDoc),a(0,o=e.playerName)}}));const i=async()=>{const{connectionId:e}=l,t=await fetch(`/api/joinGameStream/${n}`,{method:"POST",body:JSON.stringify({connectionId:e,playerSecret:c})}),a=await t.json();return console.log(`Join game stream response: ${t.status}`),a};return[o,n,s,async()=>{let{connectionId:e}=l;e||(l=r(),e=l.connectionId);const t=await fetch("/api/createGame",{method:"POST",body:JSON.stringify({connectionId:e,playerName:o})});console.log(`Create game response: ${t.status}`);const s=await t.json();c=s.playerSecret,a(1,n=s.game),201===t.status&&await i(),window.localStorage.setItem("playerSecret",c),window.localStorage.setItem("gameId",n)},async()=>{let{connectionId:e}=l;e||(l=r(),e=l.connectionId);const t=await fetch(`/api/joinGame/${n}`,{method:"POST",body:JSON.stringify({connectionId:e,playerName:o})});console.log(`Join game response: ${t.status}`);const a=await t.json();c=a.playerSecret,200===t.status&&await i(),window.localStorage.setItem("playerSecret",c),window.localStorage.setItem("gameId",n)},async()=>{window.localStorage.setItem("gameId",""),window.localStorage.setItem("playerSecret",""),a(1,n=""),c="",l.stop()},function(){o=this.value,a(0,o)},function(){o=this.value,a(0,o)},function(){n=this.value,a(1,n)}]}export default class extends e{constructor(e){super(),t(this,e,E,b,a,{})}}
